# 데이터베이스 정규화(Database Normalization)

#### 정규화란?     

 데이터의 중복을 줄이고 무결성을 향상 시키는 등 여러 목적을 달성하기 위해 관계형 데이터베이스를 정규화된 형태로 재디자인하는 것을 말한다.

#### 목적

- 불필요한 데이터를 제거, 데이터의 중복을 최소화
- 응용프로그램 단에서 불필요한 로직을 없앨 수 있다.
- 불필요한 쿼리( 예를 들면, 서브쿼리 ) 제거로 성능 향상
- 데이터베이스 구조 확장 시 재디자인을 최소화
- 무결성 제약조건의 시행을 간단하게 하기 위해서
- 각종 [이상 현상(Anomaly)](https://wkdtjsgur100.github.io/anomaly) 을 방지하기 위해서, 테이블의 구성을 논리적이고 직관적으로 한다.

#### 정규화의 과정

정규화는 1정규화 ~ 6정규화 까지 있지만, 실무에서는 대체로 1~3 정규화까지의 과정을 거친다.

- ##### 제 1정규화(First Normal Form, 1NF)

  1. 어떤 `Relation`에 속한 모든 Domain이 `원자값(atomic value)`만으로 되어 있다.

     - 하나의 컬럼은 원자값(의미가 있는 하나의 값)만으로 구성된다.(값을 여러개 저장X)

     - | ID   | 이름    | 나이   | 전화번호                         |
       | ---- | ------- | ------ | -------------------------------- |
       | 111  | steve12 | 23     | 010-0000-0001, ~~031-0000-0000~~ |
       | 222  | tomaa   | b@b.kr | 010-0000-0002                    |
       | 333  | mary192 | c@c.kr | 010-0000-0003                    |

       위에서 스티브는 전화번호를 2개 저장하였으므로 조건을 위반하였다.

  2. 모든 attribute에 반복되는 그룹(repeating group)이 나타나지 않는다.

     - `전화번호1`, `전화번호2`와 같이 하나의 속성그룹 X

       | ID   | 유저네임 | 이메일 | 전화번호1     | ~~전화번호2~~     |
       | ---- | -------- | ------ | ------------- | ----------------- |
       | 111  | steve11  | a@a.kr | 010-0000-0001 | ~~031-0000-0000~~ |
       | 222  | tom11    | b@b.kr | 010-0000-0002 |                   |
       | 333  | mary11   | c@c.kr | 010-0000-0003 |                   |

  3. 기본 키를 사용하여 관련 데이터의 각 집합을 고유하게 식별할 수 있어야 한다.

     - 중복된 키를 사용하지 않는다.

       | ID      | FULL NAME | 이메일 | 전화번호      |
       | ------- | --------- | ------ | ------------- |
       | 111     | 스티브    | a@a.kr | 010-0000-0001 |
       | ~~111~~ | steve11   | a@a.kr | 031-0000-0000 |
       | 222     | tom11     | b@b.kr | 010-0000-0002 |
       | 333     | mary11    | c@c.kr | 010-0000-0003 |

  4. 위의 상황에서 모든 데이터를 저장하면서 제 1정규화를 만족하는 디자인은 아래와 같다.

     | ID   | 유저네임 | 이메일 | 전화번호      |
     | ---- | -------- | ------ | ------------- |
     | 111  | steve11  | a@a.kr | 010-0000-0001 |
     | 222  | steve11  | a@a.kr | 031-0000-0000 |
     | 333  | tom11    | b@b.kr | 010-0000-0002 |
     | 444  | mary11   | c@c.kr | 010-0000-0003 |

  5. 

     | ID   | FULL NAME |
     | ---- | --------- |
     | 111  | 스티브    |
     | 222  | 톰        |
     | 333  | 마리      |

     | ID   | USER ID | 전화번호      |
     | ---- | ------- | ------------- |
     | 1    | 111     | 010-0000-0001 |
     | 2    | 111     | 031-0000-0000 |
     | 3    | 222     | 010-0000-0002 |
     | 4    | 333     | 010-0000-0003 |

- ##### 제 2 정규화(2NF)

  1. 모든 컬럼이 완전 함수적 종속을 만족한다.

     - 다른 말로 부분적 종속이 없어야 한다는 말.

     - 위의 제 1정규화를 만족하는 테이블에서 유저네임 `steve11`의 이메일은 `a@a.kr`이다. 유저네임만 있으면 해당하는 이메일을 알 수가 있는데, 이렇게 특정 컬럼에 종속되어 있는 컬럼이 없어야 한다는 것이다.

     - 이런 경우에는 불필요한 중복 데이터가 존재하며, 심지어 `steve11`이 등록된 자신의 이메일을 바꾸려면 두개의 테이블에서 모두 수정해줘야만 한다.

     - 따라서 이런 상황을 제거 하기 위한 방법으로 테이블을 쪼개었다.

       | ID   | 유저네임 | 이메일 |
       | ---- | -------- | ------ |
       | 111  | steve11  | a@a.kr |
       | 222  | tom11    | b@b.kr |
       | 333  | mary11   | c@c.kr |

       | ID   | USER ID | 전화번호      |
       | ---- | ------- | ------------- |
       | 1    | 111     | 010-0000-0001 |
       | 2    | 111     | 031-0000-0000 |
       | 3    | 222     | 010-0000-0002 |
       | 4    | 333     | 010-0000-0003 |

     - 이러면 두개의 테이블 모두 제 1, 2 정규화를 모두 만족하게 되며, 중복데이터를 방지하고 수정/삭제가 쉽다.

- ##### 제 3 정규화(3NF)

  1. 기본 키(PK / ID)가 아닌 속성(attribute)들은 기본 키에 이행적 함수종속이 되지 않는다.

     - `A -> B`이고 `B -> C`이면 `A -> C`의 관계가 성립되는 것을 이행적 함수 종속(Transitive Functional Dependency)라고 한다.

     - 아래와 같은 `relation`이 있다고 가정했을때,

       | 이름   | 동물 분류 | 생물 분류 |
       | ------ | --------- | --------- |
       | 호랑이 | 포유류    | 동물      |
       | 개     | 포유류    | 동물      |
       | 개구리 | 양서류    | 동물      |
       | 4      | 꽃        | 식물      |

     - `호랑이 -> 포유류`이며 `포유류->동물`이다. 따라서 `호랑이->동물`의 관계가 성립되게 된다.

     - 따라서 제 3정규화를 지키기 위해 아래와 같이 테이블을 분리한다.

       | 이름   | 동물 분류's ID |
       | ------ | -------------- |
       | 호랑이 | 1              |
       | 개     | 1              |
       | 개구리 | 2              |
       | 4      | 3              |

       | ID   | 동물 분류 | 생물 분류 |
       | ---- | --------- | --------- |
       | 1    | 포유류    | 동물      |
       | 2    | 양서류    | 동물      |
       | 3    | 꽃        | 식물      |

#### 참고

> [데이터베이스 정규화 개념 설명 및 예제](https://wkdtjsgur100.github.io/database-normalization/)
>
> [🙈[DB이론\] 정규화 ( Normalization )🐵](https://victorydntmd.tistory.com/132)